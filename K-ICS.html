<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>InsureQuant â€” K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€ë™ ì¶”ì´</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
  <style>
    :root{--bg:#ffffff; --card:#f8f9fa; --border:#e9ecef; --text:#212529; --muted:#6c757d; --primary:#0d6efd; --primary-hover:#0b5ed7;}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR}
    header{position:sticky;top:0;padding:10px 16px;border-bottom:1px solid var(--border);background:#ffffff;z-index:1000}
    .brand{font-weight:700;margin-bottom:12px;cursor:pointer;color:var(--primary);text-decoration:none}
    .brand:hover{color:var(--primary-hover)}
    .tabs{display:flex;gap:4px;margin-bottom:0}
    .tab{padding:8px 16px;border:1px solid var(--border);border-radius:8px 8px 0 0;background:var(--card);color:var(--muted);text-decoration:none;font-size:14px;font-weight:500;transition:all 0.2s;}
    .tab:hover{background:var(--primary);color:white;border-color:var(--primary)}
    .tab.active{background:var(--primary);color:white;border-color:var(--primary)}
    .container{max-width:1320px;margin:0 auto;padding:16px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:16px}
    .panel h2{margin:0 0 16px 0;color:var(--text);font-size:20px;font-weight:600}
    .panel p{color:var(--muted);line-height:1.6;margin:0 0 12px 0}
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between;margin-bottom:16px}
    .select{padding:8px 10px;border:1px solid var(--border);border-radius:8px;background:#ffffff;color:#212529}
    .chart-container{position:relative;height:500px;border:1px solid var(--border);border-radius:8px;background:#ffffff;padding:16px}
    .coming-soon{text-align:center;padding:60px 20px;color:var(--muted)}
    .coming-soon h3{font-size:24px;margin:0 0 12px 0;color:var(--text)}
    .coming-soon p{font-size:16px;margin:0}
    .table-container{margin-top:32px;}
    table{border-collapse:collapse;width:100%;}
    th, td{border:1px solid var(--border);padding:6px 8px;text-align:left;}
    th{background:var(--card);}
    th:nth-child(n+2), td:nth-child(n+2){text-align:right;} /* í•­ëª©ëª… ì œì™¸í•œ ëª¨ë“  ì…€ ì˜¤ë¥¸ìª½ ì •ë ¬ */
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="brand">InsureQuant <span class="hint" style="color:var(--muted);font-weight:400">K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€ë™ ì¶”ì´</span></a>
    <div class="tabs">
      <a href="K-ICS.html" class="tab active">K-ICS</a>
      <a href="IFRS17.html" class="tab">IFRS17</a>
      <a href="ê³µì‹œë³´ê³ ì„œ.html" class="tab">ê³µì‹œ/ë³´ê³ ì„œ</a>
    </div>
  </header>
  <div class="container">
    <div class="panel">
      <h2>ì›ë³´í—˜ì‚¬ë³„ K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€ë™ ì¶”ì´</h2>
      <p>ë³´í—˜íšŒì‚¬ë“¤ì˜ K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€í™”ë¥¼ ì‹œê³„ì—´ë¡œ ë¶„ì„í•˜ì—¬ ì•ˆì •ì„± ì¶”ì´ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>
    <div class="panel">
      <div class="controls">
        <div>
          <label>ë³´í—˜ì‚¬ ì„ íƒ: 
            <select id="company" class="select">
              <option value="">ë³´í—˜ì‚¬ ì„ íƒ</option>
              <option value="í•œí™”ìƒëª…">í•œí™”ìƒëª…</option>
              <option value="êµë³´ìƒëª…ë³´í—˜">êµë³´ìƒëª…ë³´í—˜</option>
              <option value="í¥êµ­ìƒëª…ë³´í—˜">í¥êµ­ìƒëª…ë³´í—˜</option>
              <option value="ë¼ì´ë‚˜ìƒëª…ë³´í—˜">ë¼ì´ë‚˜ìƒëª…ë³´í—˜</option>
              <option value="DBìƒëª…ë³´í—˜">DBìƒëª…ë³´í—˜</option>
              <option value="ì—ì´ë¹„ì—˜ìƒëª…ë³´í—˜">ì—ì´ë¹„ì—˜ìƒëª…ë³´í—˜</option>
              <option value="ì¼€ì´ë””ë¹„ìƒëª…ë³´í—˜">ì¼€ì´ë””ë¹„ìƒëª…ë³´í—˜</option>
              <option value="í‘¸ë³¸í˜„ëŒ€ìƒëª…ë³´í—˜">í‘¸ë³¸í˜„ëŒ€ìƒëª…ë³´í—˜</option>
              <option value="ì•„ì´ì— ë¼ì´í”„ìƒëª…ë³´í—˜">ì•„ì´ì— ë¼ì´í”„ìƒëª…ë³´í—˜</option>
              <option value="ì²˜ë¸Œë¼ì´í”„ìƒëª…ë³´í—˜">ì²˜ë¸Œë¼ì´í”„ìƒëª…ë³´í—˜</option>
              <option value="ë¹„ì—”í”¼íŒŒë¦¬ë°”ì¹´ë””í”„ìƒëª…ë³´í—˜">ë¹„ì—”í”¼íŒŒë¦¬ë°”ì¹´ë””í”„ìƒëª…ë³´í—˜</option>
              <option value="DBì†í•´ë³´í—˜">DBì†í•´ë³´í—˜</option>
              <option value="ì‚¼ì„±í™”ì¬í•´ìƒë³´í—˜">ì‚¼ì„±í™”ì¬í•´ìƒë³´í—˜</option>
              <option value="í˜„ëŒ€í•´ìƒ">í˜„ëŒ€í•´ìƒ</option>
              <option value="KBì†í•´ë³´í—˜">KBì†í•´ë³´í—˜</option>
              <option value="ë©”ë¦¬ì¸ í™”ì¬í•´ìƒë³´í—˜">ë©”ë¦¬ì¸ í™”ì¬í•´ìƒë³´í—˜</option>
              <option value="í•œí™”ì†í•´ë³´í—˜">í•œí™”ì†í•´ë³´í—˜</option>
              <option value="ë¡¯ë°ì†í•´ë³´í—˜">ë¡¯ë°ì†í•´ë³´í—˜</option>
              <option value="í¥êµ­í™”ì¬">í¥êµ­í™”ì¬</option>
              <option value="NHë†í˜‘ì†í•´ë³´í—˜">NHë†í˜‘ì†í•´ë³´í—˜</option>
              <option value="í•˜ë‚˜ì†í•´ë³´í—˜">í•˜ë‚˜ì†í•´ë³´í—˜</option>
              <option value="ì•…ì‚¬ì†í•´ë³´í—˜">ì•…ì‚¬ì†í•´ë³´í—˜</option>
              <option value="ì‹ í•œì´ì§€ì†í•´ë³´í—˜">ì‹ í•œì´ì§€ì†í•´ë³´í—˜</option>
            </select>
          </label>
        </div>
        <div>
          <label>ê¸°ê°„: 
            <select id="period" class="select">
              <option value="">ê¸°ê°„ ì„ íƒ</option>
              <option value="quarter">ë¶„ê¸°</option>
              <option value="year">ì—°ë„</option>
            </select>
          </label>
        </div>
      </div>
      <div class="chart-container">
        <div id="chart-placeholder" class="coming-soon">
          <h3>ğŸ“Š ë³´í—˜ì‚¬ì™€ ì¡°íšŒ ê¸°ê°„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</h3>
          <p>ìœ„ì˜ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ë³´í—˜ì‚¬ì™€ ê¸°ê°„ì„ ì„ íƒí•˜ë©´ ê·¸ë˜í”„ì™€ í…Œì´ë¸”ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>
        <canvas id="chart" style="display:none;"></canvas>
      </div>
      <div class="table-container" id="table-container"></div>
    </div>
  </div>
  <script>
    const jsonPath = 'kics_disclosure.json';
    let allData = [];
    let chart = null;

    // ê³µì‹œë¶„ê¸° ìµœì‹  Nê°œ ì¶”ì¶œ
    function getRecentQuarters(data, nQuarter) {
      const allQuarters = Array.from(new Set(data.map(row => row['ê³µì‹œë¶„ê¸°']))).sort((a, b) => {
        const parse = s => {
          const m = s.match(/^(\d{4})\.(\d)Q$/);
          return m ? [parseInt(m[1]), parseInt(m[2])] : [0,0];
        };
        const [ay, aq] = parse(a), [by, bq] = parse(b);
        if (ay !== by) return by - ay;
        return bq - aq;
      });
      return allQuarters.slice(0, nQuarter);
    }

    // ë³´í—˜ì‚¬/ê¸°ê°„ ëª¨ë‘ ì§€ì •ë˜ì–´ì•¼ë§Œ í…Œì´ë¸” ì¶œë ¥
    function canShowTable() {
      const company = document.getElementById('company').value;
      const period = document.getElementById('period').value;
      return company && period;
    }

    // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜ (ì²œ ë‹¨ìœ„ ì‰¼í‘œ, ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬)
    function formatNumber(value) {
      if (value === null || value === undefined || value === '') {
        return '';
      }
      
      // ë¬¸ìì—´ì—ì„œ ìˆ«ì ì¶”ì¶œ (ì‰¼í‘œ ì œê±° í›„ íŒŒì‹±)
      const strValue = String(value).replace(/,/g, '').trim();
      const numValue = parseFloat(strValue);
      
      if (isNaN(numValue)) {
        return value; // ìˆ«ìê°€ ì•„ë‹ˆë©´ ì›ë³¸ ë°˜í™˜
      }
      
      // ì†Œìˆ˜ì ì´ ìˆëŠ”ì§€ í™•ì¸ (ì •ìˆ˜ì¸ì§€ í™•ì¸)
      const hasDecimal = numValue % 1 !== 0;
      
      if (hasDecimal) {
        // ì†Œìˆ˜ì ì´ ìˆëŠ” ê²½ìš° ì²«ì§¸ ìë¦¬ê¹Œì§€ë§Œ í‘œì‹œ
        return numValue.toLocaleString('ko-KR', {
          minimumFractionDigits: 0,
          maximumFractionDigits: 1
        });
      }
      
      // ì •ìˆ˜ì¸ ê²½ìš° ì²œ ë‹¨ìœ„ ì‰¼í‘œë§Œ ì¶”ê°€
      return numValue.toLocaleString('ko-KR');
    }

    // í”¼ë²— í…Œì´ë¸” ë Œë”ë§ (í–‰: í•­ëª©ëª…, ì—´: ê³µì‹œë¶„ê¸°)
    function renderPivotTable(data, quarters) {
      if (!Array.isArray(data) || !data.length) {
        document.getElementById('table-container').innerHTML = '<p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      // í•­ëª©ëª… ëª©ë¡ ì¶”ì¶œ (í–‰)
      const itemNames = Array.from(new Set(data.map(row => row['í•­ëª©ëª…'])));
      // í…Œì´ë¸” í—¤ë”: [í•­ëª©ëª…, ...ê³µì‹œë¶„ê¸°(ì—­ìˆœ)]
      let table = '<table><thead><tr><th>í•­ëª©ëª…</th>';
      quarters.forEach(q => table += `<th>${q}</th>`);
      table += '</tr></thead><tbody>';
      itemNames.forEach(item => {
        table += `<tr><td>${item}</td>`;
        quarters.forEach(q => {
          const found = data.find(row => row['í•­ëª©ëª…'] === item && row['ê³µì‹œë¶„ê¸°'] === q);
          if (found && found['ê°’'] !== null && found['ê°’'] !== undefined && found['ê°’'] !== '') {
            table += `<td>${formatNumber(found['ê°’'])}</td>`;
          } else {
            table += '<td></td>';
          }
        });
        table += '</tr>';
      });
      table += '</tbody></table>';
      document.getElementById('table-container').innerHTML = table;
    }

    // ì—°ë§ ë¶„ê¸° ì¶”ì¶œ (ìµœì‹  ë¶„ê¸° + 1ë…„ ì „ ì—°ë§ + 2ë…„ ì „ ì—°ë§)
    function getYearEndQuarters(data) {
      const allQuarters = Array.from(new Set(data.map(row => row['ê³µì‹œë¶„ê¸°']))).sort((a, b) => {
        const parse = s => {
          const m = s.match(/^(\d{4})\.(\d)Q$/);
          return m ? [parseInt(m[1]), parseInt(m[2])] : [0,0];
        };
        const [ay, aq] = parse(a), [by, bq] = parse(b);
        if (ay !== by) return by - ay;
        return bq - aq;
      });
      
      if (allQuarters.length === 0) return [];
      
      // ìµœì‹  ë¶„ê¸°
      const latest = allQuarters[0];
      const [latestYear, latestQuarter] = (() => {
        const m = latest.match(/^(\d{4})\.(\d)Q$/);
        return m ? [parseInt(m[1]), parseInt(m[2])] : [0, 0];
      })();
      
      const selectedQuarters = [latest];
      
      // 1ë…„ ì „ ì—°ë§ (4Q)
      const year1Ago = `${latestYear - 1}.4Q`;
      if (allQuarters.includes(year1Ago)) {
        selectedQuarters.push(year1Ago);
      }
      
      // 2ë…„ ì „ ì—°ë§ (4Q)
      const year2Ago = `${latestYear - 2}.4Q`;
      if (allQuarters.includes(year2Ago)) {
        selectedQuarters.push(year2Ago);
      }
      
      // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  â†’ ê³¼ê±°)
      return selectedQuarters.sort((a, b) => {
        const parse = s => {
          const m = s.match(/^(\d{4})\.(\d)Q$/);
          return m ? [parseInt(m[1]), parseInt(m[2])] : [0,0];
        };
        const [ay, aq] = parse(a), [by, bq] = parse(b);
        if (ay !== by) return by - ay;
        return bq - aq;
      });
    }

    function getFilteredData() {
      let filtered = allData;
      // ë³´í—˜ì‚¬ í•„í„°
      const company = document.getElementById('company').value;
      if (company) filtered = filtered.filter(row => row['ì›ìˆ˜ì‚¬ëª…'] === company);
      
      // ê¸°ê°„ í•„í„°
      const period = document.getElementById('period').value;
      let selectedQuarters = [];
      
      if (period === 'quarter') {
        // ë¶„ê¸°: ì§ì „ 4ê°œ ë¶„ê¸°
        selectedQuarters = getRecentQuarters(filtered, 4);
      } else if (period === 'year') {
        // ì—°ë„: ìµœì‹  ë¶„ê¸° + 1ë…„ ì „ ì—°ë§ + 2ë…„ ì „ ì—°ë§
        selectedQuarters = getYearEndQuarters(filtered);
      }
      
      filtered = filtered.filter(row => selectedQuarters.includes(row['ê³µì‹œë¶„ê¸°']));
      return {filtered, recentQuarters: selectedQuarters};
    }

    function updateTable() {
      if (!canShowTable()) {
        document.getElementById('table-container').innerHTML = '';
        updateChart([], []); // ì•ˆë‚´ ë¬¸êµ¬ í‘œì‹œë¥¼ ìœ„í•´ í˜¸ì¶œ
        return;
      }
      const {filtered, recentQuarters} = getFilteredData();
      renderPivotTable(filtered, recentQuarters);
      updateChart(filtered, recentQuarters);
    }

    function updateChart(data, quarters) {
      const placeholder = document.getElementById('chart-placeholder');
      const ctx = document.getElementById('chart');
      
      if (!canShowTable()) {
        // ë³´í—˜ì‚¬ì™€ ê¸°ê°„ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì°¨íŠ¸ ìˆ¨ê¹€, ì•ˆë‚´ ë¬¸êµ¬ í‘œì‹œ
        if (chart) {
          chart.destroy();
          chart = null;
        }
        if (ctx) {
          ctx.style.display = 'none';
        }
        if (placeholder) {
          placeholder.style.display = 'block';
        }
        return;
      }
      
      // ë³´í—˜ì‚¬ì™€ ê¸°ê°„ì´ ì„ íƒë˜ì—ˆìœ¼ë©´ ì•ˆë‚´ ë¬¸êµ¬ ìˆ¨ê¹€, ì°¨íŠ¸ í‘œì‹œ
      if (placeholder) {
        placeholder.style.display = 'none';
      }
      if (ctx) {
        ctx.style.display = 'block';
      }
      const chartCtx = ctx.getContext('2d');
      
      // 'ë‹¤. ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨' ë°ì´í„° ì¶”ì¶œ
      const solvencyRatioData = quarters.map(q => {
        const row = data.find(r => r['í•­ëª©ëª…'] === 'ë‹¤. ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ : ê°€ Ã· ë‚˜ Ã— 100' && r['ê³µì‹œë¶„ê¸°'] === q);
        if (!row) return null;
        const value = parseFloat(String(row['ê°’']).replace(/,/g, '')) || 0;
        return value;
      });

      // 'ê¸°ë³¸ìë³¸ë¹„ìœ¨' ë°ì´í„° ì¶”ì¶œ
      const basicCapitalRatioData = quarters.map(q => {
        // ë¨¼ì € 'ê¸°ë³¸ìë³¸ë¹„ìœ¨' í•­ëª©ëª…ìœ¼ë¡œ ì§ì ‘ ê²€ìƒ‰
        let row = data.find(r => r['í•­ëª©ëª…'] === 'ê¸°ë³¸ìë³¸ë¹„ìœ¨' && r['ê³µì‹œë¶„ê¸°'] === q);
        
        if (row) {
          const value = parseFloat(String(row['ê°’']).replace(/,/g, '')) || 0;
          return value;
        }
        
        // 'ê¸°ë³¸ìë³¸'ê³¼ 'ë‚˜. ì§€ê¸‰ì—¬ë ¥ê¸°ì¤€ê¸ˆì•¡'ìœ¼ë¡œ ê³„ì‚° (ê¸°ë³¸ìë³¸ / ì§€ê¸‰ì—¬ë ¥ê¸°ì¤€ê¸ˆì•¡ * 100)
        const basicCapital = data.find(r => 
          (r['í•­ëª©ëª…'] === 'ê¸°ë³¸ìë³¸' || r['í•­ëª©ëª…'] === '2. ê¸°ë³¸ìë³¸') 
          && r['ê³µì‹œë¶„ê¸°'] === q
        );
        const requiredCapital = data.find(r => 
          (r['í•­ëª©ëª…'] === 'ë‚˜. ì§€ê¸‰ì—¬ë ¥ê¸°ì¤€ê¸ˆì•¡ (â… -â…¡+â…¢)' || 
           r['í•­ëª©ëª…'] === 'ë‚˜. ì§€ê¸‰ì—¬ë ¥ê¸°ì¤€ê¸ˆì•¡' ||
           r['í•­ëª©ëª…'] === 'ì§€ê¸‰ì—¬ë ¥ê¸°ì¤€ê¸ˆì•¡') 
          && r['ê³µì‹œë¶„ê¸°'] === q
        );
        
        if (basicCapital && requiredCapital) {
          const capital = parseFloat(String(basicCapital['ê°’']).replace(/,/g, '')) || 0;
          const required = parseFloat(String(requiredCapital['ê°’']).replace(/,/g, '')) || 0;
          return required > 0 ? (capital / required * 100) : null;
        }
        
        return null;
      });

      // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
      if (chart) {
        chart.destroy();
      }

      // ê°€ë¡œì¶•ì„ ì—­ìˆœìœ¼ë¡œ (ì˜¤ë¥¸ìª½ì´ ìµœì‹ )
      const reversedQuarters = [...quarters].reverse();
      const reversedSolvencyRatioData = [...solvencyRatioData].reverse();
      const reversedBasicCapitalRatioData = [...basicCapitalRatioData].reverse();

      // ë°ì´í„° ë²”ìœ„ ê³„ì‚° (null ì œì™¸)
      const validSolvencyData = reversedSolvencyRatioData.filter(v => v !== null && !isNaN(v));
      const validBasicCapitalData = reversedBasicCapitalRatioData.filter(v => v !== null && !isNaN(v));
      
      const solvencyMin = validSolvencyData.length > 0 ? Math.min(...validSolvencyData) : 100;
      const solvencyMax = validSolvencyData.length > 0 ? Math.max(...validSolvencyData) : 200;
      const basicCapitalMin = validBasicCapitalData.length > 0 ? Math.min(...validBasicCapitalData) : 30;
      const basicCapitalMax = validBasicCapitalData.length > 0 ? Math.max(...validBasicCapitalData) : 80;
      
      // ì£¼ì¶•ê³¼ ë³´ì¡°ì¶• ìŠ¤ì¼€ì¼ ì¡°ì •
      // ì£¼ì¶•(ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨) ë²”ìœ„: ìµœì†Œê°’ì—ì„œ ì—¬ìœ  ê³µê°„ ì¶”ê°€
      const solvencyRange = solvencyMax - solvencyMin;
      const solvencyYMin = Math.max(0, solvencyMin - solvencyRange * 0.15);
      const solvencyYMax = solvencyMax + solvencyRange * 0.15;
      
      // ë³´ì¡°ì¶•(ê¸°ë³¸ìë³¸ë¹„ìœ¨) ë²”ìœ„: ì£¼ì¶• ìµœì†Œê°’ë³´ë‹¤ í™•ì‹¤íˆ ë‚®ê²Œ ì„¤ì •
      const basicCapitalRange = basicCapitalMax - basicCapitalMin;
      const basicCapitalYMin = Math.max(0, basicCapitalMin - basicCapitalRange * 0.15);
      
      // ë³´ì¡°ì¶• ìµœëŒ€ê°’: ì£¼ì¶• ìµœì†Œê°’ì˜ 50-60% ì •ë„ë¡œ ì„¤ì •í•˜ì—¬ í•­ìƒ ì•„ë˜ì— ìœ„ì¹˜
      // ê¸°ë³¸ìë³¸ë¹„ìœ¨ì˜ ì‹¤ì œ ìµœëŒ€ê°’ê³¼ ì£¼ì¶• ìµœì†Œê°’ì˜ 60% ì¤‘ ì‘ì€ ê°’ì„ ì‚¬ìš©
      const basicCapitalYMax = Math.min(
        basicCapitalMax + basicCapitalRange * 0.15,
        solvencyYMin * 0.6
      );

      // ì°¨íŠ¸ ìƒì„±
      chart = new Chart(chartCtx, {
        type: 'line',
        data: {
          labels: reversedQuarters,
          datasets: [
            {
              label: 'ë‹¤. ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨',
              data: reversedSolvencyRatioData,
              borderColor: 'rgb(75, 192, 192)',
              backgroundColor: 'rgba(75, 192, 192, 0.1)',
              tension: 0.1,
              fill: true,
              yAxisID: 'y'
            },
            {
              label: 'ê¸°ë³¸ìë³¸ë¹„ìœ¨',
              data: reversedBasicCapitalRatioData,
              borderColor: 'rgb(255, 99, 132)',
              backgroundColor: 'rgba(255, 99, 132, 0.1)',
              tension: 0.1,
              fill: true,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë° ê¸°ë³¸ìë³¸ë¹„ìœ¨ ì‹œê³„ì—´ ì¶”ì´'
            },
            legend: {
              display: true,
              position: 'top'
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  if (context.parsed.y !== null) {
                    label += context.parsed.y.toFixed(2) + '%';
                  } else {
                    label += 'ë°ì´í„° ì—†ìŒ';
                  }
                  return label;
                }
              }
            },
            annotation: {
              annotations: {
                // ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ 130% ê¸°ì¤€ì„ 
                solvencyLine: {
                  type: 'line',
                  yMin: 130,
                  yMax: 130,
                  borderColor: 'rgb(75, 192, 192)',
                  borderWidth: 2,
                  borderDash: [5, 5],
                  label: {
                    display: true,
                    content: 'ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ 130% ê¸°ì¤€ì„ ',
                    position: 'start',
                    backgroundColor: 'rgb(75, 192, 192)',
                    color: 'white',
                    font: {
                      size: 11
                    }
                  },
                  yScaleID: 'y'
                },
                // ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ 130% ê¸°ì¤€ì„  ì•„ë˜ ê²½ê³  ì˜ì—­
                solvencyWarning: {
                  type: 'box',
                  yMin: 0,
                  yMax: 130,
                  backgroundColor: 'rgba(255, 99, 132, 0.1)',
                  borderWidth: 0,
                  yScaleID: 'y'
                },
                // ê¸°ë³¸ìë³¸ë¹„ìœ¨ 50% ê¸°ì¤€ì„ 
                basicCapitalLine: {
                  type: 'line',
                  yMin: 50,
                  yMax: 50,
                  borderColor: 'rgb(255, 99, 132)',
                  borderWidth: 2,
                  borderDash: [5, 5],
                  label: {
                    display: true,
                    content: 'ê¸°ë³¸ìë³¸ë¹„ìœ¨ 50% ê¸°ì¤€ì„ ',
                    position: 'end',
                    backgroundColor: 'rgb(255, 99, 132)',
                    color: 'white',
                    font: {
                      size: 11
                    }
                  },
                  yScaleID: 'y1'
                },
                // ê¸°ë³¸ìë³¸ë¹„ìœ¨ 50% ê¸°ì¤€ì„  ì•„ë˜ ê²½ê³  ì˜ì—­
                basicCapitalWarning: {
                  type: 'box',
                  yMin: 0,
                  yMax: 50,
                  backgroundColor: 'rgba(255, 99, 132, 0.15)',
                  borderWidth: 0,
                  yScaleID: 'y1'
                }
              }
            }
          },
          scales: {
            y: {
              type: 'linear',
              position: 'left',
              beginAtZero: false,
              min: solvencyYMin,
              max: solvencyYMax,
              title: {
                display: true,
                text: 'ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ (%)',
                color: 'rgb(75, 192, 192)'
              },
              ticks: {
                callback: function(value) {
                  return value.toFixed(1) + '%';
                },
                color: 'rgb(75, 192, 192)'
              },
              grid: {
                color: 'rgba(75, 192, 192, 0.1)'
              }
            },
            y1: {
              type: 'linear',
              position: 'right',
              beginAtZero: false,
              min: basicCapitalYMin,
              max: basicCapitalYMax,
              title: {
                display: true,
                text: 'ê¸°ë³¸ìë³¸ë¹„ìœ¨ (%)',
                color: 'rgb(255, 99, 132)'
              },
              ticks: {
                callback: function(value) {
                  return value.toFixed(1) + '%';
                },
                color: 'rgb(255, 99, 132)'
              },
              grid: {
                drawOnChartArea: false // ë³´ì¡°ì¶• ê²©ìëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ
              }
            },
            x: {
              title: {
                display: true,
                text: 'ê³µì‹œë¶„ê¸°'
              }
            }
          },
          interaction: {
            mode: 'nearest',
            axis: 'x',
            intersect: false
          }
        }
      });
    }

    fetch(jsonPath)
      .then(response => response.json())
      .then(data => {
        allData = data;
        updateTable();
        document.getElementById('company').addEventListener('change', updateTable);
        document.getElementById('period').addEventListener('change', updateTable);
      })
      .catch(e => {
        document.getElementById('table-container').innerHTML = `<p>JSON íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${e}</p>`;
      });
  </script>
</body>
</html>
