<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>InsureQuant â€” K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€ë™ ì¶”ì´</title>
  <style>
    :root{--bg:#ffffff; --card:#f8f9fa; --border:#e9ecef; --text:#212529; --muted:#6c757d; --primary:#0d6efd; --primary-hover:#0b5ed7;}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR}
    header{position:sticky;top:0;padding:10px 16px;border-bottom:1px solid var(--border);background:#ffffff;z-index:1000}
    .brand{font-weight:700;margin-bottom:12px;cursor:pointer;color:var(--primary);text-decoration:none}
    .brand:hover{color:var(--primary-hover)}
    .tabs{display:flex;gap:4px;margin-bottom:0}
    .tab{padding:8px 16px;border:1px solid var(--border);border-radius:8px 8px 0 0;background:var(--card);color:var(--muted);text-decoration:none;font-size:14px;font-weight:500;transition:all 0.2s;}
    .tab:hover{background:var(--primary);color:white;border-color:var(--primary)}
    .tab.active{background:var(--primary);color:white;border-color:var(--primary)}
    .container{max-width:1320px;margin:0 auto;padding:16px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:16px}
    .panel h2{margin:0 0 16px 0;color:var(--text);font-size:20px;font-weight:600}
    .panel p{color:var(--muted);line-height:1.6;margin:0 0 12px 0}
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between;margin-bottom:16px}
    .select{padding:8px 10px;border:1px solid var(--border);border-radius:8px;background:#ffffff;color:#212529}
    .chart-container{position:relative;height:500px;border:1px solid var(--border);border-radius:8px;background:#ffffff;padding:16px}
    .coming-soon{text-align:center;padding:60px 20px;color:var(--muted)}
    .coming-soon h3{font-size:24px;margin:0 0 12px 0;color:var(--text)}
    .coming-soon p{font-size:16px;margin:0}
    .table-container{margin-top:32px;}
    table{border-collapse:collapse;width:100%;}
    th, td{border:1px solid var(--border);padding:6px 8px;text-align:left;}
    th{background:var(--card);}
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="brand">InsureQuant <span class="hint" style="color:var(--muted);font-weight:400">K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€ë™ ì¶”ì´</span></a>
    <div class="tabs">
      <a href="K-ICS.html" class="tab active">K-ICS</a>
      <a href="IFRS17.html" class="tab">IFRS17</a>
      <a href="ê³µì‹œë³´ê³ ì„œ.html" class="tab">ê³µì‹œ/ë³´ê³ ì„œ</a>
    </div>
  </header>
  <div class="container">
    <div class="panel">
      <h2>ì›ë³´í—˜ì‚¬ë³„ K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€ë™ ì¶”ì´</h2>
      <p>ë³´í—˜íšŒì‚¬ë“¤ì˜ K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€í™”ë¥¼ ì‹œê³„ì—´ë¡œ ë¶„ì„í•˜ì—¬ ì•ˆì •ì„± ì¶”ì´ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>
    <div class="panel">
      <div class="controls">
        <div>
          <label>ë³´í—˜ì‚¬ ì„ íƒ: 
            <select id="company" class="select">
              <option value="">ë³´í—˜ì‚¬ ì„ íƒ</option>
              <option value="í•œí™”ìƒëª…">í•œí™”ìƒëª…</option>
              <option value="êµë³´ìƒëª…ë³´í—˜">êµë³´ìƒëª…ë³´í—˜</option>
              <option value="í¥êµ­ìƒëª…ë³´í—˜">í¥êµ­ìƒëª…ë³´í—˜</option>
              <option value="ë¼ì´ë‚˜ìƒëª…ë³´í—˜">ë¼ì´ë‚˜ìƒëª…ë³´í—˜</option>
              <option value="DBìƒëª…ë³´í—˜">DBìƒëª…ë³´í—˜</option>
              <option value="ì—ì´ë¹„ì—˜ìƒëª…ë³´í—˜">ì—ì´ë¹„ì—˜ìƒëª…ë³´í—˜</option>
              <option value="ì¼€ì´ë””ë¹„ìƒëª…ë³´í—˜">ì¼€ì´ë””ë¹„ìƒëª…ë³´í—˜</option>
              <option value="í‘¸ë³¸í˜„ëŒ€ìƒëª…ë³´í—˜">í‘¸ë³¸í˜„ëŒ€ìƒëª…ë³´í—˜</option>
              <option value="ì•„ì´ì— ë¼ì´í”„ìƒëª…ë³´í—˜">ì•„ì´ì— ë¼ì´í”„ìƒëª…ë³´í—˜</option>
              <option value="ì²˜ë¸Œë¼ì´í”„ìƒëª…ë³´í—˜">ì²˜ë¸Œë¼ì´í”„ìƒëª…ë³´í—˜</option>
              <option value="ë¹„ì—”í”¼íŒŒë¦¬ë°”ì¹´ë””í”„ìƒëª…ë³´í—˜">ë¹„ì—”í”¼íŒŒë¦¬ë°”ì¹´ë””í”„ìƒëª…ë³´í—˜</option>
              <option value="DBì†í•´ë³´í—˜">DBì†í•´ë³´í—˜</option>
              <option value="ì‚¼ì„±í™”ì¬í•´ìƒë³´í—˜">ì‚¼ì„±í™”ì¬í•´ìƒë³´í—˜</option>
              <option value="í˜„ëŒ€í•´ìƒ">í˜„ëŒ€í•´ìƒ</option>
              <option value="KBì†í•´ë³´í—˜">KBì†í•´ë³´í—˜</option>
              <option value="ë©”ë¦¬ì¸ í™”ì¬í•´ìƒë³´í—˜">ë©”ë¦¬ì¸ í™”ì¬í•´ìƒë³´í—˜</option>
              <option value="í•œí™”ì†í•´ë³´í—˜">í•œí™”ì†í•´ë³´í—˜</option>
              <option value="ë¡¯ë°ì†í•´ë³´í—˜">ë¡¯ë°ì†í•´ë³´í—˜</option>
              <option value="í¥êµ­í™”ì¬">í¥êµ­í™”ì¬</option>
              <option value="NHë†í˜‘ì†í•´ë³´í—˜">NHë†í˜‘ì†í•´ë³´í—˜</option>
              <option value="í•˜ë‚˜ì†í•´ë³´í—˜">í•˜ë‚˜ì†í•´ë³´í—˜</option>
              <option value="ì•…ì‚¬ì†í•´ë³´í—˜">ì•…ì‚¬ì†í•´ë³´í—˜</option>
              <option value="ì‹ í•œì´ì§€ì†í•´ë³´í—˜">ì‹ í•œì´ì§€ì†í•´ë³´í—˜</option>
            </select>
          </label>
        </div>
        <div>
          <label>ê¸°ê°„: 
            <select id="period" class="select">
              <option value="">ê¸°ê°„ ì„ íƒ</option>
              <option value="1Y">ìµœê·¼ 1ë…„</option>
              <option value="2Y">ìµœê·¼ 2ë…„</option>
              <option value="3Y">ìµœê·¼ 3ë…„</option>
              <option value="5Y">ìµœê·¼ 5ë…„</option>
            </select>
          </label>
        </div>
      </div>
      <div class="chart-container">
        <div class="coming-soon">
          <h3>ğŸ“Š ì°¨íŠ¸ ì¤€ë¹„ ì¤‘</h3>
          <p>K-ICS ì§€ê¸‰ì—¬ë ¥ë¹„ìœ¨ ë³€ë™ ì¶”ì´ ì°¨íŠ¸ê°€ ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
          <p>ë³´í—˜íšŒì‚¬ë³„ ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ì—¬ ì•ˆì •ì„± ì¶”ì´ë¥¼ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
      </div>
      <div class="table-container" id="table-container"></div>
    </div>
  </div>
  <script>
    const jsonPath = 'kics_disclosure.json';
    let allData = [];

    // ê³µì‹œë¶„ê¸° ìµœì‹  Nê°œ ì¶”ì¶œ
    function getRecentQuarters(data, nQuarter) {
      const allQuarters = Array.from(new Set(data.map(row => row['ê³µì‹œë¶„ê¸°']))).sort((a, b) => {
        const parse = s => {
          const m = s.match(/^(\d{4})\.(\d)Q$/);
          return m ? [parseInt(m[1]), parseInt(m[2])] : [0,0];
        };
        const [ay, aq] = parse(a), [by, bq] = parse(b);
        if (ay[0] != by[0]) return by[0] - ay[0];
        return by[1] - aq[1];
      });
      return allQuarters.slice(0, nQuarter);
    }

    // ë³´í—˜ì‚¬/ê¸°ê°„ ëª¨ë‘ ì§€ì •ë˜ì–´ì•¼ë§Œ í…Œì´ë¸” ì¶œë ¥
    function canShowTable() {
      const company = document.getElementById('company').value;
      const period = document.getElementById('period').value;
      return company && period;
    }

    // í”¼ë²— í…Œì´ë¸” ë Œë”ë§ (í–‰: í•­ëª©ëª…, ì—´: ê³µì‹œë¶„ê¸°)
    function renderPivotTable(data, quarters) {
      if (!Array.isArray(data) || !data.length) {
        document.getElementById('table-container').innerHTML = '<p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      // í•­ëª©ëª… ëª©ë¡ ì¶”ì¶œ (í–‰)
      const itemNames = Array.from(new Set(data.map(row => row['í•­ëª©ëª…'])));
      // í…Œì´ë¸” í—¤ë”: [í•­ëª©ëª…, ...ê³µì‹œë¶„ê¸°(ì—­ìˆœ)]
      let table = '<table><thead><tr><th>í•­ëª©ëª…</th>';
      quarters.forEach(q => table += `<th>${q}</th>`);
      table += '</tr></thead><tbody>';
      itemNames.forEach(item => {
        table += `<tr><td>${item}</td>`;
        quarters.forEach(q => {
          const found = data.find(row => row['í•­ëª©ëª…'] === item && row['ê³µì‹œë¶„ê¸°'] === q);
          table += `<td>${found ? (found['ê°’'] ?? '') : ''}</td>`;
        });
        table += '</tr>';
      });
      table += '</tbody></table>';
      document.getElementById('table-container').innerHTML = table;
    }

    function getFilteredData() {
      let filtered = allData;
      // ë³´í—˜ì‚¬ í•„í„°
      const company = document.getElementById('company').value;
      if (company) filtered = filtered.filter(row => row['ì›ìˆ˜ì‚¬ëª…'] === company);
      // ê¸°ê°„ í•„í„° (ìµœì‹  Nê°œ ë¶„ê¸°ë§Œ ë‚¨ê¹€)
      const period = document.getElementById('period').value;
      let nQuarter = 4;
      if (period === '2Y') nQuarter = 8;
      if (period === '3Y') nQuarter = 12;
      if (period === '5Y') nQuarter = 20;
      const recentQuarters = getRecentQuarters(filtered, nQuarter);
      filtered = filtered.filter(row => recentQuarters.includes(row['ê³µì‹œë¶„ê¸°']));
      return {filtered, recentQuarters};
    }

    function updateTable() {
      if (!canShowTable()) {
        document.getElementById('table-container').innerHTML = '';
        return;
      }
      const {filtered, recentQuarters} = getFilteredData();
      renderPivotTable(filtered, recentQuarters);
    }

    fetch(jsonPath)
      .then(response => response.json())
      .then(data => {
        allData = data;
        updateTable();
        document.getElementById('company').addEventListener('change', updateTable);
        document.getElementById('period').addEventListener('change', updateTable);
      })
      .catch(e => {
        document.getElementById('table-container').innerHTML = `<p>JSON íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${e}</p>`;
      });
  </script>
</body>
</html>
